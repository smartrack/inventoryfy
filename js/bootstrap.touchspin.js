(function(e){"use strict";e.fn.TouchSpin=function(t){var n={min:0,max:100,initval:"",step:1,decimals:0,stepinterval:100,forcestepdivisibility:"round",stepintervaldelay:500,prefix:"",postfix:"",prefix_extraclass:"",postfix_extraclass:"",booster:true,boostat:10,maxboostedstep:false,mousewheel:true,buttondown_class:"btn btn-default",buttonup_class:"btn btn-default"};return this.each(function(){function v(){if(i.data("alreadyinitialized")){return}i.data("alreadyinitialized",true);if(!i.is("input")){console.log("Must be an input.");return}y();m();L();w();x();T();N();C();u.input.css("display","block")}function m(){if(r.initval!==""&&i.val()===""){i.val(r.initval)}}function g(e){b(e);L();var t=Number(u.input.val());u.input.val(t.toFixed(r.decimals))}function y(){r=e.extend({},n,s,t)}function b(t){r=e.extend({},r,t)}function w(){var e=i.val(),t=i.parent();if(e!==""){e=Number(e).toFixed(r.decimals)}i.data("initvalue",e).val(e);i.addClass("form-control");if(t.hasClass("input-group")){E(t)}else{S()}}function E(t){t.addClass("bootstrap-touchspin");var n=i.prev(),s=i.next();var u,a,f='<span class="input-group-addon bootstrap-touchspin-prefix">'+r.prefix+"</span>",l='<span class="input-group-addon bootstrap-touchspin-postfix">'+r.postfix+"</span>";if(n.hasClass("input-group-btn")){u='<button class="'+r.buttondown_class+' bootstrap-touchspin-down" type="button">-</button>',n.append(u)}else{u='<span class="input-group-btn"><button class="'+r.buttondown_class+' bootstrap-touchspin-down" type="button">-</button></span>';e(u).insertBefore(i)}if(s.hasClass("input-group-btn")){a='<button class="'+r.buttonup_class+' bootstrap-touchspin-up" type="button">+</button>',s.prepend(a)}else{a='<span class="input-group-btn"><button class="'+r.buttonup_class+' bootstrap-touchspin-up" type="button">+</button></span>';e(a).insertAfter(i)}e(f).insertBefore(i);e(l).insertAfter(i);o=t}function S(){var t='<div class="input-group bootstrap-touchspin"><span class="input-group-btn"><button class="'+r.buttondown_class+' bootstrap-touchspin-down" type="button">-</button></span><span class="input-group-addon bootstrap-touchspin-prefix">'+r.prefix+'</span><span class="input-group-addon bootstrap-touchspin-postfix">'+r.postfix+'</span><span class="input-group-btn"><button class="'+r.buttonup_class+' bootstrap-touchspin-up" type="button">+</button></span></div>';o=e(t).insertBefore(i);e(".bootstrap-touchspin-prefix",o).after(i);if(i.hasClass("input-sm")){o.addClass("input-group-sm")}else if(i.hasClass("input-lg")){o.addClass("input-group-lg")}}function x(){u={down:e(".bootstrap-touchspin-down",o),up:e(".bootstrap-touchspin-up",o),input:e("input",o),prefix:e(".bootstrap-touchspin-prefix",o).addClass(r.prefix_extraclass),postfix:e(".bootstrap-touchspin-postfix",o).addClass(r.postfix_extraclass)}}function T(){if(r.prefix==""){u.prefix.hide()}if(r.postfix==""){u.postfix.hide()}}function N(){i.on("keydown",function(e){var t=e.keyCode||e.which;if(t===38){if(d!=="up"){O();D()}e.preventDefault()}else if(t===40){if(d!=="down"){M();_()}e.preventDefault()}});i.on("keyup",function(e){var t=e.keyCode||e.which;if(t===38){P()}else if(t===40){P()}});i.on("blur",function(){L()});u.down.on("keydown",function(e){var t=e.keyCode||e.which;if(t===32||t===13){if(d!=="down"){M();_()}e.preventDefault()}});u.down.on("keyup",function(e){var t=e.keyCode||e.which;if(t===32||t===13){P()}});u.up.on("keydown",function(e){var t=e.keyCode||e.which;if(t===32||t===13){if(d!=="up"){O();D()}e.preventDefault()}});u.up.on("keyup",function(e){var t=e.keyCode||e.which;if(t===32||t===13){P()}});u.down.on("mousedown touchstart",function(e){M();_();e.preventDefault();e.stopPropagation()});u.up.on("mousedown touchstart",function(e){O();D();e.preventDefault();e.stopPropagation()});u.up.on("mouseout touchleave touchend touchcancel",function(e){if(!d){return}e.stopPropagation();P()});u.down.on("mouseout touchleave touchend touchcancel",function(e){if(!d){return}e.stopPropagation();P()});u.down.on("mousemove touchmove",function(e){if(!d){return}e.stopPropagation();e.preventDefault()});u.up.on("mousemove touchmove",function(e){if(!d){return}e.stopPropagation();e.preventDefault()});e(document).on("mouseup touchend touchcancel",function(e){if(!d){return}e.preventDefault();P()});e(document).on("mousemove touchmove scroll scrollstart",function(e){if(!d){return}e.preventDefault();P()});if(r.mousewheel){i.on("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent.wheelDelta||-e.originalEvent.detail;e.stopPropagation();e.preventDefault();if(t<0){M()}else{O()}})}}function C(){i.on("touchspin.uponce",function(){P();O()});i.on("touchspin.downonce",function(){P();M()});i.on("touchspin.startupspin",function(e){D()});i.on("touchspin.startdownspin",function(){_()});i.on("touchspin.stopspin",function(){P()});i.on("touchspin.updatesettings",function(e,t){g(t)})}function k(e){switch(r.forcestepdivisibility){case"round":return(Math.round(e/r.step)*r.step).toFixed(r.decimals);break;case"floor":return(Math.floor(e/r.step)*r.step).toFixed(r.decimals);break;case"ceil":return(Math.ceil(e/r.step)*r.step).toFixed(r.decimals);break;default:return e}}function L(){var e,t,n;e=i.val();if(e===""){return}if(r.decimals>0&&e==="."){return}t=parseFloat(e);if(isNaN(t)){t=0}n=t;if(t.toString()!==e){n=t}if(t<r.min){n=r.min}if(t>r.max){n=r.max}n=k(n);if(Number(e).toString()!==n.toString()){i.val(n);i.trigger("change")}}function A(){if(!r.booster){return r.step}else{var e=Math.pow(2,Math.floor(p/r.boostat))*r.step;if(r.maxboostedstep){if(e>r.maxboostedstep){e=r.maxboostedstep;a=Math.round(a/e*e)}}return Math.max(r.step,e)}}function O(){L();a=parseFloat(u.input.val());if(isNaN(a)){a=0}var e=a,t=A();a=a+t;if(a>r.max){a=r.max;i.trigger("touchspin.on.max");P()}u.input.val(Number(a).toFixed(r.decimals));if(e!==a){i.trigger("change")}}function M(){L();a=parseFloat(u.input.val());if(isNaN(a)){a=0}var e=a,t=A();a=a-t;if(a<r.min){a=r.min;i.trigger("touchspin.on.min");P()}u.input.val(a.toFixed(r.decimals));if(e!==a){i.trigger("change")}}function _(){P();p=0;d="down";i.trigger("touchspin.on.startspin");i.trigger("touchspin.on.startdownspin");c=setTimeout(function(){f=setInterval(function(){p++;M()},r.stepinterval)},r.stepintervaldelay)}function D(){P();p=0;d="up";i.trigger("touchspin.on.startspin");i.trigger("touchspin.on.startupspin");h=setTimeout(function(){l=setInterval(function(){p++;O()},r.stepinterval)},r.stepintervaldelay)}function P(){clearTimeout(c);clearTimeout(h);clearInterval(f);clearInterval(l);switch(d){case"up":i.trigger("touchspin.on.stopupspin");i.trigger("touchspin.on.stopspin");break;case"down":i.trigger("touchspin.on.stopdownspin");i.trigger("touchspin.on.stopspin");break}p=0;d=false}var r,i=e(this),s=i.data(),o,u,a,f,l,c,h,p=0,d=false;v()})}})(jQuery)